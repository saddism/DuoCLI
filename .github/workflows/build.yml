name: Build & Release

on:
  push:
    tags:
      - 'v*'

permissions:
  contents: write

jobs:
  build-mac:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install setuptools
      - run: npm install
      - run: npm run build:ts
      - run: npm run copy:html
      - run: npx electron-builder --mac --publish never
      - uses: actions/upload-artifact@v4
        with:
          name: mac-build
          path: release/*.dmg

  build-win:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install setuptools
      - run: npm install
      - run: npm run build:ts
      - run: npm run copy:html
      - run: npx electron-builder --win --publish never
      - uses: actions/upload-artifact@v4
        with:
          name: win-build
          path: release/*.exe

  release:
    needs: [build-mac, build-win]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/download-artifact@v4
        with:
          name: mac-build
          path: artifacts/mac
      - uses: actions/download-artifact@v4
        with:
          name: win-build
          path: artifacts/win
      - uses: softprops/action-gh-release@v2
        with:
          files: |
            artifacts/mac/*.dmg
            artifacts/win/*.exe
          body: |
            ## DuoCLI â€” åœ¨æ‰‹æœºä¸Šç”¨ Claude Code

            æ‰‹æœºç”µè„‘å®æ—¶åŒæ­¥çš„ AI ç¼–ç¨‹ç»ˆç«¯ã€‚è¿ä¸ŠåŒä¸€ä¸ª WiFiï¼Œæ‰‹æœºå’Œç”µè„‘å…±äº«åŒä¸€ä¸ªç»ˆç«¯ä¼šè¯ï¼ŒåŒå‘å®æ—¶åŒæ­¥ã€‚

            **äº®ç‚¹åŠŸèƒ½ï¼š**
            - ğŸ“± æ‰‹æœºç”µè„‘å®æ—¶åŒæ­¥ â€” æ‰‹æœºä¸Šæ‰“çš„å­—ç”µè„‘ä¸Šå®æ—¶å‡ºç°ï¼Œåè¿‡æ¥ä¹Ÿä¸€æ ·
            - ğŸ”„ å¤šç»ˆç«¯å¹¶è¡Œç®¡ç† â€” åŒæ—¶è·‘ Claude Codeã€Codexã€Geminiã€Kimi
            - ğŸ“¸ Git å¿«ç…§ä¸å›æ»š â€” AI æ”¹ä»£ç å‰è‡ªåŠ¨å¿«ç…§ï¼Œä¸€é”®æ’¤é”€
            - ğŸ¤– AI æ™ºèƒ½æ ‡é¢˜ â€” è‡ªåŠ¨è¯†åˆ«ç»ˆç«¯å†…å®¹ç”Ÿæˆæ ‡é¢˜
            - ğŸ”” Web Push é€šçŸ¥ â€” AI è·‘å®Œä»»åŠ¡æ‰‹æœºæ¨é€æé†’

            **å®‰è£…è¯´æ˜ï¼š**

            **macOS ç”¨æˆ·ï¼š** ä¸‹è½½ .dmg æ–‡ä»¶ï¼Œæ‰“å¼€åæ‹–å…¥ Applicationsã€‚é¦–æ¬¡æ‰“å¼€å¦‚æç¤º"æ— æ³•éªŒè¯å¼€å‘è€…"ï¼Œå³é”®ç‚¹å‡»åº”ç”¨ â†’ æ‰“å¼€ å³å¯ã€‚

            **Windows ç”¨æˆ·ï¼š** ä¸‹è½½ .exe å®‰è£…åŒ…ï¼ŒåŒå‡»å®‰è£…ã€‚å¦‚å¼¹å‡º SmartScreen è­¦å‘Šï¼Œç‚¹å‡»"æ›´å¤šä¿¡æ¯" â†’ "ä»è¦è¿è¡Œ"ã€‚
